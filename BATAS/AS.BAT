@ECHO OFF

IF %1==/B GOTO :ARGB

SET INPIDX=0
TYPE %1 > ASINP%INPIDX%.BAT
SET OUTFILE=%2

GOTO :START

:ARGB
SET OLDPATH=%PATH%
SET PATH=%2;%PATH%
CALL %2\AS %3 %4 %5 %6 %7 %8 %9
SET PATH=%OLDPATH%
SET OLDPATH=
GOTO :EOF

:START

IF EXIST %OUTFILE% DEL %OUTFILE%

SET MODE=COUNT
SET IP=256
CALL ASINP%INPIDX%

CALL CLRFILE > %OUTFILE%

SET MODE=EMIT
SET IP=256
CALL ASINP%INPIDX%

SET MODE=CLEAN
CALL ASINP%INPIDX%

DEL ASINP%INPIDX%.BAT > NUL
SET INPIDX=
SET OUTFILE=
SET MODE=
SET IP=
SET REG=
SET MRM=
SET DISPBYTES=
SET RESULT=
:EOF
